<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference Number Email Sender & CSV Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a modern look */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Basic styling for the custom message box */
        #messageBox {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #4CAF50; /* Green background */
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
        }
        #messageBox.error {
            background-color: #f44336; /* Red for errors */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Enter Adverity Reference Number</h1>

        <p class="text-gray-600 mb-8">This can be copied and pasted from the table above.</p>

        <div class="mb-6">
            <label for="referenceNo" class="block text-gray-700 text-left text-sm font-medium mb-2">Reference Number:</label>
            <input
                type="text"
                id="referenceNo"
                placeholder="e.g., ABC-12345"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800"
                aria-label="Reference Number Input"
            >
        </div>

        <div class="flex flex-col space-y-4">
            <button
                id="approveBtn"
                class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
            >
                <svg class="inline-block w-5 h-5 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Approve
            </button>
            <button
                id="rejectBtn"
                class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
            >
                <svg class="inline-block w-5 h-5 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Reject
            </button>
        </div>
    </div>

    <div id="messageBox"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const referenceNoInput = document.getElementById('referenceNo');
            const approveBtn = document.getElementById('approveBtn');
            const rejectBtn = document.getElementById('rejectBtn');
            const messageBox = document.getElementById('messageBox');

            // Define recipient email addresses for each action
            const approveRecipient = 'd754f18c-88d7-40ae-97dc-bfbb5b62a752@datatap.adverity.com';
            const rejectRecipient = '01c46440-09c1-4539-8fc2-dc8e36624d5d@datatap.adverity.com';

            /**
             * Displays a custom message box with a given message and type (success/error).
             * @param {string} message - The message to display.
             * @param {string} type - 'success' or 'error'.
             */
            function showMessageBox(message, type) {
                messageBox.textContent = message;
                messageBox.className = ''; // Clear previous classes
                messageBox.classList.add('px-6', 'py-3', 'rounded-lg', 'font-semibold', 'shadow-lg', 'text-white', 'z-1000', 'fixed', 'top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2'); // Add common classes

                if (type === 'error') {
                    messageBox.classList.add('bg-red-600');
                } else {
                    messageBox.classList.add('bg-green-600');
                }
                messageBox.style.display = 'block';

                // Hide the message after 3 seconds
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 3000);
            }
        
            /**
             * Creates and downloads a CSV file with the reference number.
             * @param {string} refNo - The reference number.
             */
            function downloadCsv(refNo) {
                const csvContent = "ReferenceNumber\n" + refNo;
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);

                link.setAttribute("href", url);
                link.setAttribute("download", `Adverity_Ref_${refNo}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            /**
             * Handles sending the email based on the action (Approve/Reject).
             * @param {string} actionType - 'Approve' or 'Reject'.
             * @param {string} recipient - The email address of the recipient.
             */
            function sendEmail(actionType, recipient) {
                const refNo = referenceNoInput.value.trim();

                if (!refNo) {
                    showMessageBox('Please enter a reference number.', 'error');
                    return;
                }
                
                // Download the CSV file
                downloadCsv(refNo);
                
                const body = encodeURIComponent(`Action: ${actionType}\n\n**PLEASE ATTACH THE FILE: Adverity_Ref_${refNo}.csv in your downloads folder**`);

                const mailtoLink = `mailto:${recipient}?subject=${encodeURIComponent(`${actionType} Reference Number: ${refNo}`)}&body=${body}`;

                try {
                    // Open the email client
                    window.location.href = mailtoLink;
                    showMessageBox(`CSV downloaded and email client opened for ${actionType} action!`, 'success');
                } catch (error) {
                    showMessageBox('Could not open email client. Please ensure you have one configured.', 'error');
                    console.error('Error opening mailto link:', error);
                }
            }
        
            // Event listeners for the buttons
            approveBtn.addEventListener('click', () => {
                sendEmail('Approve', approveRecipient);
            });
        
            rejectBtn.addEventListener('click', () => {
                sendEmail('Reject', rejectRecipient);
            });
        });
    </script>
</body>
</html>
